"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[99],{7854:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=t(5893),a=t(1151);const r={title:"IBC NameService Module",sidebar_label:"IBC NameService (Part 2)",sidebar_position:8,slug:"/build/name-service-ibc-module"},s="IBC Name Service Module",o={id:"build-your-application/ibc-module",title:"IBC NameService Module",description:"In this section, you will build on top of the Name Service tutorial to add cross chain functionality. This will allow you to sent a name from another network.",source:"@site/versioned_docs/version-v0.50.x/02-build-your-application/08-ibc-module.md",sourceDirName:"02-build-your-application",slug:"/build/name-service-ibc-module",permalink:"/spawn/v0.50/build/name-service-ibc-module",draft:!1,unlisted:!1,tags:[],version:"v0.50.x",sidebarPosition:8,frontMatter:{title:"IBC NameService Module",sidebar_label:"IBC NameService (Part 2)",sidebar_position:8,slug:"/build/name-service-ibc-module"},sidebar:"defaultSidebar",previous:{title:"Summary",permalink:"/spawn/v0.50/build/name-service-summary"},next:{title:"IBC Contract (Part 3)",permalink:"/spawn/v0.50/build/name-service-ibc-contract"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create your chain",id:"create-your-chain",level:2},{value:"Scaffold the IBC Module",id:"scaffold-the-ibc-module",level:2},{value:"Use the NameService Module",id:"use-the-nameservice-module",level:2},{value:"Provide NameService to the IBC Module",id:"provide-nameservice-to-the-ibc-module",level:2},{value:"Set Name on IBC Packet",id:"set-name-on-ibc-packet",level:2},{value:"Start Testnet",id:"start-testnet",level:2},{value:"Import Testnet Helpers",id:"import-testnet-helpers",level:2},{value:"Connect Your IBC Modules",id:"connect-your-ibc-modules",level:2},{value:"Submit Name Service Name Over IBC",id:"submit-name-service-name-over-ibc",level:2},{value:"Summary",id:"summary",level:2},{value:"What you Learned",id:"what-you-learned",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ibc-name-service-module",children:"IBC Name Service Module"}),"\n",(0,i.jsx)(n.p,{children:"In this section, you will build on top of the Name Service tutorial to add cross chain functionality. This will allow you to sent a name from another network."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/spawn/v0.50/install/system-setup",children:"System Setup"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/spawn/v0.50/install/install-spawn",children:"Install Spawn"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/spawn/v0.50/build/name-service",children:"Build Your Name Service Chain Tutorial"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"create-your-chain",children:"Create your chain"}),"\n",(0,i.jsxs)(n.p,{children:["You should already have a network, ",(0,i.jsx)(n.code,{children:"rollchain"}),", with the nameservice module from the nameservice tutorial. If you do not, complete that tutorial now."]}),"\n",(0,i.jsx)(n.admonition,{title:"warning",type:"note",children:(0,i.jsxs)(n.p,{children:["Make sure you do not have the previous testnet still running by stopping it with: ",(0,i.jsx)(n.code,{children:"killall -9 rolld"})]})}),"\n",(0,i.jsx)(n.h2,{id:"scaffold-the-ibc-module",children:"Scaffold the IBC Module"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# if you are not already in the chain directory:\ncd rollchain\n\n# scaffold the base IBC module for The\n# cross chain name service\nspawn module new nsibc --ibc-module\n\n# compile latest code with matching module name\n# failure to do this will result in: `panic: reflect: New(nil)`\nmake proto-gen\n"})}),"\n",(0,i.jsx)(n.h2,{id:"use-the-nameservice-module",children:"Use the NameService Module"}),"\n",(0,i.jsx)(n.p,{children:"You now use the nameservice module you built previously within this new IBC module. This will allow you to save the name mapping on the name service, making it available for both IBC and native chain interactions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="x/nsibc/keeper/keeper.go"',children:'import (\n\t...\n\t// highlight-next-line\n\tnameservicekeeper "github.com/rollchains/rollchain/x/nameservice/keeper"\n)\n\ntype Keeper struct {\n\t...\n\t// highlight-next-line\n\tNameServiceKeeper *nameservicekeeper.Keeper\n}\n'})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Keeper Setup Image"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/user-attachments/assets/4dd3e50d-1528-4ae4-91a2-a27612bf69d7",alt:"View"})})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="x/nsibc/keeper/keeper.go"',children:"// NewKeeper creates a new Keeper instance.\nfunc NewKeeper(\n\t...\n\t// highlight-next-line\n\tnsk *nameservicekeeper.Keeper, // placed on the last line of NewKeeper\n) Keeper {\n    ...\n\n\tk := Keeper{\n\t\t...\n\t\t// highlight-next-line\n\t\tNameServiceKeeper: nsk,\n\t}\n"})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"NewKeeper Image"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/user-attachments/assets/7639e468-a354-468d-8368-6bedd3c142a7",alt:"View"})})]}),"\n",(0,i.jsx)(n.h2,{id:"provide-nameservice-to-the-ibc-module",children:"Provide NameService to the IBC Module"}),"\n",(0,i.jsxs)(n.p,{children:["You must now give the IBC module access to nameservice keeper. It needs this reference so that the logic and connections can be shared. This is done in the ",(0,i.jsx)(n.code,{children:"app/app.go"})," file. Find where the NameService IBC line is and update it to include the ",(0,i.jsx)(n.code,{children:"&app.NameserviceKeeper,"})," reference."]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the ",(0,i.jsx)(n.code,{children:"NameserviceKeeper"})," set just after the ",(0,i.jsx)(n.code,{children:"NsibcKeeper"})," is set. If you would like to re-order the original NameService keeper, you can do so."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="app/app.go"',children:"\t// Create the nsibc IBC Module Keeper\n\tapp.NsibcKeeper = nsibckeeper.NewKeeper(\n\t\tappCodec,\n\t\truntime.NewKVStoreService(keys[nsibctypes.StoreKey]),\n\t\tapp.IBCKeeper.ChannelKeeper,\n\t\tapp.IBCKeeper.PortKeeper,\n\t\tscopedNsibc,\n\t\tauthtypes.NewModuleAddress(govtypes.ModuleName).String(),\n\t\t// highlight-next-line\n\t\t&app.NameserviceKeeper, // placed on the last line of NewKeeper\n\t)\n"})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Application NameService Reference Image"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/user-attachments/assets/6da58e1d-481b-46ba-bb66-d6c4a96971d0",alt:"View"})})]}),"\n",(0,i.jsx)(n.h2,{id:"set-name-on-ibc-packet",children:"Set Name on IBC Packet"}),"\n",(0,i.jsxs)(n.p,{children:["Now that the IBC module has access to the nameservice, you can add the logic to set a name received from another chain (called the counterparty). To implement, the ",(0,i.jsx)(n.code,{children:"OnRecvPacket"})," method has a placeholder for where the logic should run called ",(0,i.jsx)(n.code,{children:"handleOnRecvLogic"}),". Find the ",(0,i.jsx)(n.code,{children:"OnRecvPacket"})," in the ibc_module.go file, then find where the ",(0,i.jsx)(n.code,{children:"handleOnRecvLogic"})," method resides."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="x/nsibc/ibc_module.go"',children:"// Find this method in the file\nfunc (im ExampleIBCModule) handleOnRecvLogic(ctx context.Context, data types.ExamplePacketData) error {\n\t...\n\treturn nil\n}\n"})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"handleOnRecvLogic location"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/user-attachments/assets/011cb6cb-6664-47b9-a09e-fe1b62862987",alt:"View"})})]}),"\n",(0,i.jsx)(n.p,{children:"Once found, remove the lines within and replace with the following return."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",metastring:'title="x/nsibc/ibc_module.go"',children:'func (im ExampleIBCModule) handleOnRecvLogic(ctx context.Context, data types.ExamplePacketData) error {\n\t// highlight-start\n\tif len(data.SomeData) > 32 {\n\t\treturn fmt.Errorf("name cannot be longer than 32 characters")\n\t}\n\treturn im.keeper.NameServiceKeeper.NameMapping.Set(ctx, data.Sender, data.SomeData)\n\t// highlight-end\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This sets the name mapping from the sender to some data (the name) in the original nameservice module."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"This is for example to show cross module interaction / extension with IBC.\nYou could just as easily write the NameMapping in the ibc keeper store as well."})}),"\n",(0,i.jsx)(n.h2,{id:"start-testnet",children:"Start Testnet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# build chain binary\nmake install\n\n# verify the binary works. if you get a panic,\n# `make proto-gen`, then re `make install`\nrolld\n\n# Build docker image, set configs, keys, and install binary\n#\n# Error 1 (ignored) codes are okay here if you already have\n# the keys and configs setup. If so you only have to `make local-image`\n# in future runs :)\nmake setup-testnet\n\n# run testnet between itself and an IBC relayer\n# this will take a minute\nlocal-ic start self-ibc\n"})}),"\n",(0,i.jsx)(n.h2,{id:"import-testnet-helpers",children:"Import Testnet Helpers"}),"\n",(0,i.jsxs)(n.p,{children:["Pasting the following lines in your terminal will import helper functions to interact with the testnet.\nThe source is publicly available on GitHub to review. It gives you the ability to interact with the testnet easily using special ",(0,i.jsx)(n.code,{children:"ICT_"})," commands."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Local Interchain comes with a bash client helper for interaction as well. Check it out if you love bash"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -s https://raw.githubusercontent.com/strangelove-ventures/interchaintest/main/local-interchain/bash/source.bash > ict_source.bash\nsource ./ict_source.bash\n"})}),(0,i.jsxs)(n.p,{children:["Further ",(0,i.jsx)(n.code,{children:"local-ic interact"})," sub commands can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/strangelove-ventures/interchaintest/tree/main/local-interchain",children:"interchaintest/local-interchain documentation"}),"."]})]}),"\n",(0,i.jsx)(n.h2,{id:"connect-your-ibc-modules",children:"Connect Your IBC Modules"}),"\n",(0,i.jsxs)(n.p,{children:["You are ready to connect the two chains with your IBC module protocol. The ",(0,i.jsx)(n.a,{href:"https://github.com/cosmos/relayer",children:"cosmos/relayer"})," is already running between the 2 networks now."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"A Channel is a connection between two chains, like a highway. A port is a specific protocol (or logic) that can connect with itself on another chain.\nFor example; transfer to transfer, nsibc to nsibc, but transfer to nsibc can not be done. The version is just extra information (metadata) about the connection."}),(0,i.jsx)(n.p,{children:'These values are found in the keys.go file as the module name. By default version is just the module name + "-1".'})]}),"\n",(0,i.jsx)(n.p,{children:"Execute the command on the testnet to connect the two chains with the IBC module with the relayer."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# This will take a minute as it connects multiple\n# networks together via the relayer process\nlocal-ic interact localchain-1 relayer-exec "rly tx connect localchain-1_localchain-2 --src-port=nsibc --dst-port=nsibc --order=unordered --version=nsibc-1"\n\n# Running the channels command now shows 2 channels, one for `transfer`\n# and 1 for `nsibc`, marked as channel-1.\nlocal-ic interact localchain-1 get_channels\n'})}),"\n",(0,i.jsx)(n.h2,{id:"submit-name-service-name-over-ibc",children:"Submit Name Service Name Over IBC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Set the IBC name from chain 1.\n# view this command in x/nsibc/client/tx.go\nrolld tx nsibc example-tx nsibc channel-1 testname --from acc0 --chain-id localchain-1 --yes\n\n# View the logs\nrolld q tx DCDBFA80AE95F7C010296623CDB89E1A537CCC6A279A952B5C66C82DA15652B0\n\n# Verify chain 2 set the name (\n# `rolld keys show -a acc0` from chain-1\nlocal-ic interact localchain-2 query "nameservice resolve roll1hj5fveer5cjtn4wd6wstzugjfdxzl0xpg2te87"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"You just build an IBC module that interacts with your other nameservice module! It allowed you to set your name from a different network entirely and securely with IBC."}),"\n",(0,i.jsx)(n.h2,{id:"what-you-learned",children:"What you Learned"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Scaffolding an IBC module"}),"\n",(0,i.jsx)(n.li,{children:"Importing another module"}),"\n",(0,i.jsx)(n.li,{children:"Adding business logic for an IBC request"}),"\n",(0,i.jsx)(n.li,{children:"Connecting two chains with a custom IBC protocol"}),"\n",(0,i.jsx)(n.li,{children:"Sending your first IBC packet from chain A"}),"\n",(0,i.jsx)(n.li,{children:"Processing the packet on chain B and verifying it was set"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>s});var i=t(7294);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);